<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>Gerenciador de Tarefas</title>

    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }

        table {
            border-collapse: collapse;
            width: 100%;
            margin-top: 20px;
        }

        th, td {
            border: 1px solid #ddd;
            padding: 8px;
            vertical-align: middle;
        }

        th { background-color: #f2f2f2; }

        .btn-upload {
            display: inline-block;
            padding: 4px 10px;
            margin-left: 8px;
            background: #eee;
            border: 1px solid #ccc;
            cursor: pointer;
            border-radius: 4px;
        }

        .pdf-link {
            margin-right: 8px;
            color: blue;
            text-decoration: underline;
        }
        .top-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .menu-botoes {
            display: flex;
            gap: 10px;
        }

        .menu-botoes a,
        .menu-botoes button {
            padding: 6px 12px;
            border: 1px solid #ccc;
            background: #f2f2f2;
            cursor: pointer;
            border-radius: 4px;
            text-decoration: none;
            color: black;
            font-size: 14px;
        }

        .menu-botoes a:hover,
        .menu-botoes button:hover {
            background: #e0e0e0;
        }
    </style>
</head>

<body>

<div class="top-bar">
    <h2>Tabela de tarefas</h2>

    <div class="menu-botoes">
        <a href="/calendario">Calend√°rio</a>
        <a href="/">Tarefas</a>
        <button type="button">Notas</button>
        <a href="/logout">Sair</a>
    </div>
</div>


<div style="margin:10px 0">
    <button onclick="removerSelecionados()">üóëÔ∏è Remover</button>
</div>

<table>
<thead>
<tr>
    <th>Selecionar</th>
    <th>Descri√ß√£o</th>
    
    <th style="position: relative;">
        <span style="display:flex; align-items:center; justify-content:center; gap:6px;">
            Status

            <span onclick="toggleFiltroStatus()"
                style="cursor:pointer; display:flex; align-items:center;">
                <svg width="14" height="14" viewBox="0 0 24 24" fill="none"
                    stroke="currentColor" stroke-width="2"
                    stroke-linecap="round" stroke-linejoin="round">
                    <polygon points="22 3 2 3 10 12 10 19 14 21 14 12 22 3"></polygon>
                </svg>
            </span>
        </span>

        <select id="filtro-status"
                onchange="filtrarStatus(); fecharFiltroStatus()"
                style="
                    display:none;
                    position:absolute;
                    top:100%;
                    left:0;
                    z-index:10;
                    width:140px;
                    margin-top:4px;
                ">
            <option value="">Todos</option>
            <option value="A fazer">A fazer</option>
            <option value="Em andamento">Em andamento</option>
            <option value="Conclu√≠do">Conclu√≠do</option>
        </select>
    </th>



    <th>Data</th>
    <th>Respons√°vel</th>
    <th>Observa√ß√µes</th>
    <th>Arquivo</th>
</tr>
</thead>

<tbody>

{% for tarefa in tarefas %}
<tr>
    <td><input type="checkbox" class="chk-remover" data-id="{{ tarefa.ID }}"></td>

    <td><input type="text" value="{{ tarefa.Descri√ß√£o or '' }}"
        data-id="{{ tarefa.ID }}" data-coluna="Descri√ß√£o"></td>

    <td>
        <select data-id="{{ tarefa.ID }}" data-coluna="Status">
            <option value="">-- selecione --</option>
            <option value="A fazer" {% if tarefa.Status=="A fazer" %}selected{% endif %}>A fazer</option>
            <option value="Em andamento" {% if tarefa.Status=="Em andamento" %}selected{% endif %}>Em andamento</option>
            <option value="Conclu√≠do" {% if tarefa.Status=="Conclu√≠do" %}selected{% endif %}>Conclu√≠do</option>
        </select>
    </td>

    <td><input type="date" value="{{ tarefa.Data or '' }}"
        data-id="{{ tarefa.ID }}" data-coluna="Data"></td>

    <td><input type="text" value="{{ tarefa.Respons√°vel or '' }}"
        data-id="{{ tarefa.ID }}" data-coluna="Respons√°vel"></td>

    <td><input type="text" value="{{ tarefa.Observa√ß√µes or '' }}"
        data-id="{{ tarefa.ID }}" data-coluna="Observa√ß√µes"></td>

    <td>
        {% if tarefa.PDF %}
            <a class="pdf-link" target="_blank"
               href="{{ tarefa.PDF }}">{{ tarefa.PDF.split('/')[-1] }}</a>
        {% else %}
            <span class="pdf-link">Nenhum arquivo</span>
        {% endif %}

        <label class="btn-upload">
            Escolher arquivo
            <input type="file" hidden
                   data-id="{{ tarefa.ID }}"
                   onchange="uploadPDF(this)">
        </label>
    </td>
</tr>
{% endfor %}

<!-- LINHA NOVA -->
<tr class="linha-nova">
    <td><input type="checkbox"></td>

    <td><input type="text" data-coluna="Descri√ß√£o"></td>

    <td>
        <select data-coluna="Status">
            <option value="">-- selecione --</option>
            <option>A fazer</option>
            <option>Em andamento</option>
            <option>Conclu√≠do</option>
        </select>
    </td>

    <td><input type="date" data-coluna="Data"></td>
    <td><input type="text" data-coluna="Respons√°vel"></td>
    <td><input type="text" data-coluna="Observa√ß√µes"></td>
    <td><input type="file" onchange="uploadPDF(this)"></td>
</tr>

</tbody>
</table>
<script src="/static/js/tarefas.js"></script>
</body>
</html>
